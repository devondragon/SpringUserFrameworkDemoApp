<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout}">

<head>
	<title th:utext="#{page.title.updateUser}">Update Profile</title>
</head>

<body>
	<div layout:fragment="content">
		<section id="main_content" class="my-5">
			<div class="container">
				<div class="text-center mb-4">
					<h1 th:utext="#{label.form.update-user}">Update Profile</h1>
				</div>

				<div id="globalMessage" class="alert alert-info text-center d-none"></div>

				<!-- Update User Form -->
				<div class="card shadow-sm">
					<div class="card-body">
						<form id="updateUserForm" th:action="@{/user/updateUser}" method="POST">
							<!-- First Name -->
							<div class="row mb-3 align-items-center">
								<label for="firstName" class="col-sm-3 col-form-label" th:utext="#{label.user.first-name}">First Name</label>
								<div class="col-sm-7">
									<input type="text" id="firstName" name="firstName" class="form-control" th:value="${user.firstName}" required>
									<div id="firstNameError" class="form-text text-danger d-none"></div>
								</div>
							</div>

							<!-- Last Name -->
							<div class="row mb-3 align-items-center">
								<label for="lastName" class="col-sm-3 col-form-label" th:utext="#{label.user.last-name}">Last Name</label>
								<div class="col-sm-7">
									<input type="text" id="lastName" name="lastName" class="form-control" th:value="${user.lastName}" required>
									<div id="lastNameError" class="form-text text-danger d-none"></div>
								</div>
							</div>

							<!-- Submit Button -->
							<div class="text-center">
								<button type="submit" class="btn btn-primary" th:utext="#{action.update-user}">Update</button>
							</div>
						</form>
					</div>
				</div>

				<!-- Authentication Methods Card -->
				<div id="auth-methods-section" class="card shadow-sm mt-4 d-none">
					<div class="card-header">
						<h5 class="mb-0"><i class="bi bi-shield-lock me-2"></i>Authentication Methods</h5>
					</div>
					<div class="card-body">
						<div id="auth-method-badges" class="mb-3">
							<span class="text-muted">Loading...</span>
						</div>
						<div id="removePasswordContainer" class="d-none">
							<button id="removePasswordBtn" type="button" class="btn btn-outline-warning btn-sm">
								<i class="bi bi-shield-x me-1"></i> Remove Password (Go Passwordless)
							</button>
						</div>
						<div id="setPasswordContainer" class="d-none">
							<a href="/user/update-password.html" class="btn btn-outline-primary btn-sm">
								<i class="bi bi-key me-1"></i> Set a Password
							</a>
						</div>
					</div>
				</div>

				<!-- Remove Password Confirmation Modal -->
				<div class="modal fade" id="removePasswordModal" tabindex="-1" aria-labelledby="removePasswordModalLabel" aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered">
						<div class="modal-content">
							<div class="modal-header bg-warning-subtle">
								<h5 class="modal-title" id="removePasswordModalLabel"><i class="bi bi-exclamation-triangle me-2"></i>Remove Password</h5>
								<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
							</div>
							<div class="modal-body">
								<p>You are about to remove your password. After this, you will only be able to sign in using your passkeys.</p>
								<p class="mb-2"><strong>Type REMOVE to confirm:</strong></p>
								<input type="text" id="removePasswordConfirmInput" class="form-control" placeholder="Type REMOVE">
								<div id="removePasswordError" class="form-text text-danger d-none mt-1"></div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
								<button type="button" id="confirmRemovePasswordBtn" class="btn btn-warning" disabled>Remove Password</button>
							</div>
						</div>
					</div>
				</div>

				<!-- Passkey Management Section -->
				<div id="passkey-section" class="card shadow-sm mt-4">
					<div class="card-header d-flex justify-content-between align-items-center">
						<h5 class="mb-0"><i class="bi bi-key me-2"></i>Passkeys</h5>
					</div>
					<div class="card-body">
						<div id="passkeyMessage" class="alert d-none text-center"></div>

						<!-- Register New Passkey -->
						<div class="input-group mb-3">
							<input type="text" id="passkeyLabel" class="form-control" placeholder="Passkey name (e.g. MacBook Pro)" maxlength="64">
							<button id="registerPasskeyBtn" type="button" class="btn btn-primary">
								<i class="bi bi-plus-circle me-1"></i> Add Passkey
							</button>
						</div>

						<!-- Passkey List -->
						<div id="passkeys-list">
							<p class="text-muted">Loading passkeys...</p>
						</div>
					</div>
				</div>

					<!-- Rename Passkey Modal -->
				<div class="modal fade" id="renamePasskeyModal" tabindex="-1" aria-labelledby="renamePasskeyLabel" aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="renamePasskeyLabel"><i class="bi bi-pencil me-2"></i>Rename Passkey</h5>
								<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
							</div>
							<div class="modal-body">
								<label for="renamePasskeyInput" class="form-label">Passkey name</label>
								<input type="text" id="renamePasskeyInput" class="form-control" maxlength="64" placeholder="e.g. MacBook Pro">
								<div class="d-flex justify-content-between mt-1">
									<div id="renamePasskeyError" class="form-text text-danger d-none"></div>
									<small id="renamePasskeyCount" class="form-text text-muted ms-auto">0 / 64</small>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
								<button type="button" id="confirmRenameButton" class="btn btn-primary">Save</button>
							</div>
						</div>
					</div>
				</div>

				<!-- Additional Options -->
				<div class="text-center mt-4">
					<a id="changePasswordLink" href="/user/update-password.html" class="btn btn-outline-secondary" th:utext="#{action.update-password}">Change Password</a>
					<a href="/user/delete-account.html" class="btn btn-outline-danger ms-2" th:utext="#{action.delete-account}">Delete Account</a>
				</div>
			</div>
		</section>

		<script type="module" th:src="@{/js/user/update-user.js}"></script>
		<script type="module" th:src="@{/js/user/webauthn-manage.js}"></script>
	</div>
</body>

</html>
